(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2898:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>S});var t=a(5155),n=a(7068),i=a.n(n),s=a(2115),l=a(8719),o=a(4751),c=a.n(o);let d=async e=>{console.log("isbn:",e);try{let i=await fetch("https://openlibrary.org/api/books?bibkeys=ISBN:".concat(e,"&format=json&jscmd=data")),s=await i.json();if(!s["ISBN:".concat(e)])return{error:"Book not found. ISBN: ".concat(e)};{var r,a,t,n;let i=s["ISBN:".concat(e)],o=(null==(a=i.identifiers)||null==(r=a.isbn_10)?void 0:r[0])||(null==(n=i.identifiers)||null==(t=n.isbn_13)?void 0:t[0])||e,c=await (0,l.NA)(o),d=i.subjects?i.subjects.map(e=>e.name):[];return{isbn:o,title:i.title,authors:i.authors?i.authors.map(e=>e.name).join(", "):"Unknown",publish_date:i.publish_date||"Unknown",cover:i.cover?i.cover.large:null,description:i.notes||"No description available",duplicate:c,tags:d}}}catch(e){return console.error("Error fetching book info:",e),{error:"Error fetching book info"}}},h=e=>{let{onScan:r}=e,a=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(a.current)return c().init({inputStream:{type:"LiveStream",target:a.current,constraints:{facingMode:"environment",width:{min:640,ideal:1280},height:{min:480,ideal:720},aspectRatio:{ideal:1.777}}},locator:{patchSize:"medium",halfSample:!1},decoder:{readers:["ean_reader"]},locate:!0,debug:{drawBoundingBox:!0,showFrequency:!0,drawScanline:!0}},e=>{if(e)return void console.error("Quagga init error:",e);c().start()}),c().onDetected(async e=>{let a=e.codeResult.code;console.log("Detected ISBN: ",a),c().stop(),r(await d(a))}),()=>{c().stop()}},[r]),(0,t.jsx)("div",{children:(0,t.jsx)("div",{ref:a,style:{width:"100%",height:"300px"}})})};var u=a(5902),p=a(9756),b=a(8391),j=a(6028),m=a(9780),x=a(6565),g=a(1504),y=a(4481),f=a(2912),v=a(465);function S(){let[e,r]=(0,s.useState)(null),[a,n]=(0,s.useState)(!1),[o,c]=(0,s.useState)(!1),[S,C]=(0,s.useState)(),[w,k]=(0,s.useState)(""),[_,N]=(0,s.useState)(!1),[I,B]=(0,s.useState)(!1),[A,E]=(0,s.useState)({added:new Date,author:"",isbn:"",loaned:!1,published:"",title:"",type:"book",cover:"",tags:[]});function $(){r(null),n(!1),c(!1),C(null),N(!1),k(""),B(!1),E({added:new Date,author:"",isbn:"",loaned:!1,published:"",title:"",type:"book",cover:"",tags:[]})}let M=async()=>{r(await d(S))},D=e=>r=>{E({...A,[e]:r.target.value})},G=async()=>{try{await (0,l.UC)({...A,duplicate:!1}),$()}catch(e){console.error("Error saving manual entry:",e)}};return(0,t.jsxs)("div",{children:[(0,t.jsx)(u.A,{}),(0,t.jsxs)("main",{children:[(0,t.jsx)("h2",{children:"Add media to library: "}),!a&&(0,t.jsxs)("div",{className:i().buttonGroup,children:[(0,t.jsx)(p.$,{onClick:e=>n(!a),children:"Scan Barcode"}),(0,t.jsx)(p.$,{onClick:e=>c(!o),children:"Search by ISBN"}),(0,t.jsx)(p.$,{onClick:e=>N(!_),children:"Manually Add"})]}),!e&&o&&(0,t.jsxs)(j.l,{title:"ISBN Search",onClose:e=>$(),children:[(0,t.jsxs)(g.c,{children:[(0,t.jsx)("label",{className:"k-label",children:"ISBN:"}),(0,t.jsx)(x.p,{required:!0,onChange:e=>{let r=e.target.value.replace(/\D/g,"").slice(0,13);C(r),r.length>0&&10!==r.length&&13!==r.length?k(!0):k(!1)},value:S}),w&&(0,t.jsx)("p",{children:"ISBN must be 10 or 13 digits long"})]}),console.log(S),(0,t.jsxs)(m.f,{children:[(0,t.jsx)(p.$,{disabled:w,onClick:e=>M(S),children:"Search"}),(0,t.jsx)(p.$,{onClick:e=>$(),children:"Cancel"})]})]}),!e&&_&&(0,t.jsxs)(j.l,{title:"Manually Add Media Information",onClose:e=>$(),children:[(0,t.jsxs)(b.Z,{type:"warning",children:["Note that manually added media is not checked for duplication in the database. ",(0,t.jsx)("br",{})," ",(0,t.jsx)("b",{children:"'Scan Barcode' or 'Search by ISBN' input methods are recommended whenever possible."})]}),(0,t.jsx)(x.p,{label:"Title",value:A.title,onChange:D("title")}),(0,t.jsx)(x.p,{label:"Author(s)",value:A.author,onChange:D("author")}),(0,t.jsx)(x.p,{label:"Publish Year (optional)",value:A.published,onChange:D("published")}),(0,t.jsx)(x.p,{label:"ISBN (optional)",value:A.isbn,onChange:D("isbn")}),(0,t.jsxs)(m.f,{children:[(0,t.jsx)(p.$,{themeColor:"primary",onClick:G,children:"Add to Library"}),(0,t.jsx)(p.$,{onClick:e=>$(),children:"Cancel"})]})]}),!e&&a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h,{onScan:e=>r(e)}),(0,t.jsx)(p.$,{onClick:e=>$(),children:"Cancel"})]}),e&&(0,t.jsxs)(t.Fragment,{children:[e.error&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:["Error: ",e.error]}),(0,t.jsx)(p.$,{onClick:e=>void(r(null),n(!0)),children:"Rescan"}),(0,t.jsx)(p.$,{onClick:e=>$(),children:"Cancel"})]}),!e.error&&(0,t.jsxs)(j.l,{title:"Search Results",className:i().dialog,children:[e.duplicate&&(0,t.jsx)(b.Z,{type:"warning",children:" This title is already in your library."}),(0,t.jsx)("img",{src:e.cover,className:i().cover}),(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"ISBN:"})," ",e.isbn]}),(0,t.jsxs)("p",{style:{textTransform:"capitalize"},children:[(0,t.jsx)("b",{children:"Title:"})," ",(0,t.jsx)("i",{children:e.title})]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"Author(s):"})," ",e.authors]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"Published:"})," ",e.publish_date]}),(0,t.jsxs)(m.f,{children:[(0,t.jsx)(p.$,{themeColor:"primary",disabled:e.duplicate,onClick:r=>{let a;return a={type:"book",cover:e.cover,title:e.title,author:e.authors,isbn:e.isbn,published:function(e){if(!e)return"";let r=e.match(/\b\d{4}\b/);return r?r[0]:""}(e.publish_date),added:new Date,loaned:!1,tags:e.tags},void((0,l.UC)(a),B(!0),$(),setTimeout(()=>B(!1),3e3))},children:"Add to Library"}),(0,t.jsx)(p.$,{onClick:e=>$(),children:"Close"})]})]})]})]}),(0,t.jsx)(y.z,{children:I&&(0,t.jsx)(f.N,{className:i().position,children:(0,t.jsx)(v.E,{className:i().notification,type:{style:"success",icon:!0},closable:!0,onClose:()=>B(!1),children:(0,t.jsx)("p",{children:"Your data has been saved."})})})})]})}},5902:(e,r,a)=>{"use strict";a.d(r,{A:()=>o});var t=a(5155),n=a(9946),i=a(2241),s=a(8120),l=a.n(s);function o(){return(0,t.jsxs)(n.h,{className:l().header,children:[(0,t.jsx)(i.o,{children:(0,t.jsx)("h1",{children:"Media Library"})}),(0,t.jsxs)(i.o,{children:[(0,t.jsx)("a",{href:"https://kathryngraysonnanz.github.io/media-query/",children:"Add"}),(0,t.jsx)("a",{href:"https://kathryngraysonnanz.github.io/media-query/library",children:"Search"}),(0,t.jsx)("a",{href:"https://kathryngraysonnanz.github.io/media-query//browse",children:"Browse"})]})]})}},6205:(e,r,a)=>{Promise.resolve().then(a.bind(a,2898))},7068:e=>{e.exports={buttonGroup:"page_buttonGroup__c65K1",cover:"page_cover__87eLZ",position:"page_position__QMUUw",notification:"page_notification__dd2H1"}},8120:e=>{e.exports={header:"header_header__zSvjR"}},8719:(e,r,a)=>{"use strict";a.d(r,{NA:()=>l,xM:()=>o,Fn:()=>h,UC:()=>s,Ho:()=>c,KN:()=>d});var t=a(5317);let n=(0,a(3915).Wp)({apiKey:"AIzaSyCUm4lKOrEMD2NCf_OTNluVxfl_X_4XPF8",authDomain:"media-query-gn.firebaseapp.com",projectId:"media-query-gn",storageBucket:"media-query-gn.firebasestorage.app",messagingSenderId:"329944024899",appId:"1:329944024899:web:b8a9dc072c216b858191f6",measurementId:"G-M964RJ1DLQ"}),i=(0,t.aU)(n),s=async e=>{try{let r=await (0,t.gS)((0,t.rJ)(i,"media"),{...e});return console.log("Media saved with ID:",r.id),r.id}catch(e){console.error("Error saving media to Firestore:",e)}},l=async e=>{let r=(0,t.rJ)(i,"media"),a=(0,t.P)(r,(0,t._M)("isbn","==",e));return!(await (0,t.GG)(a)).empty},o=async()=>{try{return(await (0,t.GG)((0,t.rJ)(i,"media"))).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching media:",e),[]}},c=async e=>{if(!e.trim())return[];let r=(0,t.rJ)(i,"media"),a=(0,t.P)(r),n=await (0,t.GG)(a),s=e.toLowerCase();return n.docs.map(e=>({id:e.id,...e.data()})).filter(e=>{var r,a;let t=null==(r=e.title)?void 0:r.toLowerCase().includes(s),n=null==(a=e.author)?void 0:a.toLowerCase().includes(s),i=!!Array.isArray(e.tags)&&e.tags.some(e=>e.toLowerCase().includes(s));return t||n||i})},d=async(e,r,a)=>{try{let n=(0,t.H9)(i,"media",e);await (0,t.mZ)(n,{loaned:{name:r,date:a.toISOString()}})}catch(e){console.error("Error updating loan info:",e)}},h=async e=>{try{let r=(0,t.H9)(i,"media",e);await (0,t.mZ)(r,{loaned:!1})}catch(e){console.error("Error updating loan info:",e)}}}},e=>{var r=r=>e(e.s=r);e.O(0,[995,992,191,415,846,754,441,684,358],()=>r(6205)),_N_E=e.O()}]);